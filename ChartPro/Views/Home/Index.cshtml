@using Microsoft.AspNetCore.Http;
@{
    Layout = null;
    ViewData["Title"] = "Home page";
}
<!doctype html>
<html lang="en">
<head>
    <add name="Access-Control-Allow-Origin" value="*" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <title>Chat with Libby Kathi</title>
    <!-- Favicon -->
    <link rel="apple-touch-icon" href="https://chat-girls.pro/app-assets/images/ico/apple-icon-120.png">
    <link rel="shortcut icon" type="image/x-icon" href="https://chat-girls.pro/app-assets/images/ico/favicon.ico">

    <link rel="stylesheet" href="https://chat-girls.pro/app-assets/chat/vendor/bundle.css">

    <link rel="stylesheet" href="https://chat-girls.pro/app-assets/chat/vendor/enjoyhint/enjoyhint.css">

    <!-- App styles -->
    <link rel="stylesheet" href="https://chat-girls.pro/app-assets/chat/dist/css/app.min.css">

    <link rel="stylesheet" href="https://chat-girls.pro/app-assets/plugins/lightbox-master/dist/ekko-lightbox.css">

</head>
<body>
    <!-- page loading -->
    <div class="page-loading"></div>
    <div class="modal fade" id="nameTour" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-zoom" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i data-feather="users" class="mr-2"></i> Confirm Your Identity
                    </h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <i class="ti-close"></i>
                    </button>
                </div>
                <div class="modal-body">
                    <form>
                        <div class="form-group">
                            <label for="group_name" class="col-form-label">Your Name</label>
                            <div class="input-group">
                                <input class="form-control" id="contact_name" name="name" placeholder="Ex. Jond Doe">
                            </div>
                        </div>

                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" id="contact_name_submit" class="btn btn-primary">Continue</button>
                </div>
            </div>
        </div>
    </div>
    <div class="layout">

        <!-- navigation -->
        <nav class="navigation">
            <div class="nav-group">
                <ul>
                    <li class="logo">
                        <a href="#">
                            <svg version="1.1" xmlns="http://www.w3.org/2000/svg"
                                 xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
                                 width="612px" height="612px" viewBox="0 0 612 612"
                                 style="enable-background:new 0 0 612 612;" xml:space="preserve">
                            <g>
                            <g id="_x32__26_">
                            <g>
                            <path d="M401.625,325.125h-191.25c-10.557,0-19.125,8.568-19.125,19.125s8.568,19.125,19.125,19.125h191.25
                                    c10.557,0,19.125-8.568,19.125-19.125S412.182,325.125,401.625,325.125z M439.875,210.375h-267.75
                                    c-10.557,0-19.125,8.568-19.125,19.125s8.568,19.125,19.125,19.125h267.75c10.557,0,19.125-8.568,19.125-19.125
                                    S450.432,210.375,439.875,210.375z M306,0C137.012,0,0,119.875,0,267.75c0,84.514,44.848,159.751,114.75,208.826V612
                                    l134.047-81.339c18.552,3.061,37.638,4.839,57.203,4.839c169.008,0,306-119.875,306-267.75C612,119.875,475.008,0,306,0z
                                    M306,497.25c-22.338,0-43.911-2.601-64.643-7.019l-90.041,54.123l1.205-88.701C83.5,414.133,38.25,345.513,38.25,267.75
                                    c0-126.741,119.875-229.5,267.75-229.5c147.875,0,267.75,102.759,267.75,229.5S453.875,497.25,306,497.25z" />

                                    </g>
                                </g>
                            </g>
                        </svg>
                        </a>
                    </li>
                    <li>
                        <a class="active" data-navigation-target="chats" href="#" data-toggle="tooltip" title="Chats"
                           data-placement="right">
                            <span class="badge badge-warning"></span>
                            <i data-feather="message-circle"></i>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="dark-light-switcher" data-toggle="tooltip" title="Dark mode"
                           data-placement="right">
                            <i data-feather="moon"></i>
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
        <!-- ./ navigation -->
        <!-- content -->
        <div class="content">
            <!-- sidebar group -->
            <div class="sidebar-group">
                <!-- Chats sidebar -->
                <div id="chats" class="sidebar active">
                    <header>
                        <span>Chats</span>
                        <ul class="list-inline">
                            <li class="list-inline-item d-xl-none d-inline">
                                <a href="#" class="btn btn-outline-light text-danger sidebar-close">
                                    <i data-feather="x"></i>
                                </a>
                            </li>
                        </ul>
                    </header>

                    <div class="sidebar-body">
                        <ul class="list-group list-group-flush">

                            <li class="list-group-item open-chat">
                                <div>
                                    <figure class="avatar">
                                        <img src="https://steamcdn-a.akamaihd.net/steamcommunity/public/images/avatars/b5/b5ea76ada823f6110bd6b75fc8782a92874e6825_full.jpg" class="rounded-circle" alt="image">
                                    </figure>
                                </div>
                                <div class="users-list-body">
                                    <div>
                                        <h5>Libby Kathi</h5>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <!-- ./ Chats sidebar -->

            </div>
            <!-- ./ sidebar group -->
            <!-- chat -->
            <div class="chat" id="chat">
                <div class="chat-header">
                    <div class="chat-header-user">
                        <figure class="avatar">
                            <a href="#" data-navigation-target="contact-information"><img src="https://steamcdn-a.akamaihd.net/steamcommunity/public/images/avatars/b5/b5ea76ada823f6110bd6b75fc8782a92874e6825_full.jpg" class="rounded-circle" alt="https://steamcdn-a.akamaihd.net/steamcommunity/public/images/avatars/b5/b5ea76ada823f6110bd6b75fc8782a92874e6825_full.jpg"></a>
                        </figure>
                        <div>
                            <h5><a href="#" style="color: #333;" data-navigation-target="contact-information">Libby Kathi</a></h5>
                            <small class="text-success">
                                <i><i class="fa fa-circle"></i> Online</i>
                            </small>
                        </div>
                    </div>
                    <div class="chat-header-action">
                        <ul class="list-inline">
                            <li class="list-inline-item d-xl-none d-inline">
                                <a href="#" class="btn btn-outline-light mobile-navigation-button">
                                    <i data-feather="menu"></i>
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a href="#" class="btn btn-outline-light" data-toggle="dropdown">
                                    <i data-feather="more-horizontal"></i>
                                </a>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <a href="#" data-navigation-target="contact-information"
                                       class="dropdown-item">Profile</a>
                                </div>
                                <div class="dropdown-menu dropdown-menu-right">
                                    <a href="#" data-navigation-target="contact-information"
                                       class="dropdown-item">LogOut</a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="chat-body" id="chatbox">
                    <div class="messages" id="messages">

                    </div>
                </div>

                <div class="chat-footer">
                    <form id="message_form">
                        <input type="hidden" id="UserName" value=@Context.Session.GetString("UserName") class="text">                      <input type="text" class="form-control" name="description" id="message" placeholder="Write a message." autocomplete="off">
                        <div class="form-buttons">
                            <input type="file" name="attachment" id="attachment" style="display:none;">
                            <button id="add_attchment" class="btn btn-light" data-toggle="tooltip" title="Add files" type="button">
                                <i data-feather="paperclip"></i>
                            </button>
                            <button class="btn btn-primary" type="submit" id="send" value="Send">
                                <i data-feather="send"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            <!-- ./ chat -->

            <div class="sidebar-group">
                <div id="contact-information" class="sidebar">
                    <header>
                        <span>Profile</span>
                        <ul class="list-inline">
                            <li class="list-inline-item">
                                <a href="#" class="btn btn-outline-light text-danger sidebar-close">
                                    <i data-feather="x"></i>
                                </a>
                            </li>
                        </ul>
                    </header>
                    <div class="sidebar-body">
                        <div class="pl-4 pr-4">
                            <div class="text-center">
                                <figure class="avatar avatar-xl mb-4">
                                    <a href="https://steamcdn-a.akamaihd.net/steamcommunity/public/images/avatars/b5/b5ea76ada823f6110bd6b75fc8782a92874e6825_full.jpg" data-toggle="lightbox"><img src="https://steamcdn-a.akamaihd.net/steamcommunity/public/images/avatars/b5/b5ea76ada823f6110bd6b75fc8782a92874e6825_full.jpg" class="rounded-circle" alt="Libby Kathi"></a>
                                </figure>
                                <h5 class="mb-1">Libby Kathi</h5>
                                <small class="text-muted font-italic">Last seen: Today</small>

                                <ul class="nav nav-tabs justify-content-center mt-5" id="myTab" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link active" id="home-tab" data-toggle="tab" href="#home" role="tab"
                                           aria-controls="home" aria-selected="true">About</a>
                                    </li>
                                </ul>
                            </div>
                            <div class="tab-content" id="myTabContent">
                                <div class="tab-pane fade show active" id="home" role="tabpanel" aria-labelledby="home-tab">
                                    <div class="mt-4 mb-4">
                                        <h6>City</h6>
                                        <p class="text-muted">Ahmedabad, Gujarat</p>
                                        <h6>Age</h6>
                                        <p class="text-muted">32</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://chat-girls.pro/app-assets/chat/vendor/bundle.js"></script>
    <script src="https://chat-girls.pro/app-assets/chat/dist/js/app.min.js"></script>
    <script src="lib/signalr/signalr.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {
            let userName = $("#UserName").val();
            $.ajax({
                type: 'Get',
                url: '/Home/GetHistoryMessages',
                dataType: 'json',
                success: function (result) {
                    $.each(result, function (key, value) {
                        if (value.userName == "You") {
                            $('#messages').append('<div class="message-item  outgoing-message  "><div class="message-avatar"> <figure class="avatar"><a href="https://chat-girls.pro/app-assets/chat/images/nophoto.png" data-toggle="lightbox"><img src="https://chat-girls.pro/app-assets/chat/images/nophoto.png" class="rounded-circle" alt="You@elseLibby Kathi"></a></figure><div><h5>You</h5><div class="time">' + formatJSONDate(value.messageDate) + '</div></div></div><div class="message-content">' + value.message + '</div></div>');
                            scrollfunction();
                        } else if (value.userName == userName) {
                            $('#messages').append('<div id="lead_form" data-sid="outgoing267b-2326e4521-4521f-267bc-2326e4521f"><div id="body-outgoing267b-2326e4521-4521f-267bc-2326e4521f" style="display:none;">undefined</div><div class="message-item  message-outgoing267b-2326e4521-4521f-267bc-2326e4521f"><div class="message-avatar"><figure class="avatar"><img src="https://steamcdn-a.akamaihd.net/steamcommunity/public/images/avatars/b5/b5ea76ada823f6110bd6b75fc8782a92874e6825_full.jpg" class="rounded-circle"></figure><div><h5>Libby Kathi</h5><div class="time" style="display:block" id="timeoutgoing267b-2326e4521-4521f-267bc-2326e4521f"> ' + formatJSONDate(value.messageDate) + ' </div></div></div><div class="message-content" style="display:block" id="outgoing267b-2326e4521-4521f-267bc-2326e4521f"><span class="text-typing">' + value.message + '</span></div></div></div>');
                            scrollfunction();
                        }
                    });

                }
            });
           
        })
    </script>
    <script>
        const connection = new signalR.HubConnectionBuilder()
            .withUrl("/chat")
            .build();

        connection.start().catch(err => console.error(err.toString()));

        connection.on('Send', (message, UserName) => {
            appendLine(message, UserName);
        });

        document.getElementById('message_form').addEventListener('submit', event => {
            let message = $('#message').val();
            let = UserName = $('#UserName').val();
            $('#message').val('');

            connection.invoke('Send', message, UserName);
            event.preventDefault();
        });

        function appendLine(message, color) {
            let msgElement = document.createElement('em');
            msgElement.innerText = ` ${message}`;

            let li = document.createElement('li');
            li.appendChild(msgElement);
            var today = new Date();
            var time = today.getHours() + ":" + today.getMinutes();
            var times = today.getTime;
            var divid = today.getSeconds() + Math.floor((Math.random() * 100000) + 1);
            //$('#messages').append(span);
            $('#messages').append('<div class="message-item  outgoing-message  "><div class="message-avatar"> <figure class="avatar"><a href="https://chat-girls.pro/app-assets/chat/images/nophoto.png" data-toggle="lightbox"><img src="https://chat-girls.pro/app-assets/chat/images/nophoto.png" class="rounded-circle" alt="You@elseLibby Kathi"></a></figure><div><h5>You</h5><div class="time">' + formatAMPM(new Date) + '</div></div></div><div class="message-content">' + li.textContent + '</div></div>');
            setTimeout(function myfunction() {
                $("#messages").append('<div class="message-item  message-outgoingd365-263efc731-c7317-d365f-263efc7317" id="' + divid + '"><div class="message-avatar"><figure class="avatar"><img src="https://steamcdn-a.akamaihd.net/steamcommunity/public/images/avatars/b5/b5ea76ada823f6110bd6b75fc8782a92874e6825_full.jpg" class="rounded-circle"></figure><div><h5>Libby Kathi</h5><div class="time" style="display:none" id="timeoutgoingd365-263efc731-c7317-d365f-263efc7317">' + formatAMPM(new Date) + ' </div></div></div><div class="message-content" style="display:block" id="outgoingd365-263efc731-c7317-d365f-263efc7317"><span class="text-typing">Typing...</span></div></div>')
                scrollfunction();
            }, 800);
            scrollfunction();
            DefaultMessage(divid);

        };
        function DefaultMessage(divid) {
            $.ajax({
                type: 'Get',
                url: '/Home/DefaultMsg',
                dataType: 'json',
                success: function (result) {
                    setTimeout(function myfunction() {
                        if (result == "Typing....") {
                            $("#" + divid + "").show();
                        } else {
                            $("#" + divid + "").hide();
                            $('#messages').append('<div id="lead_form" data-sid="outgoing267b-2326e4521-4521f-267bc-2326e4521f"><div id="body-outgoing267b-2326e4521-4521f-267bc-2326e4521f" style="display:none;">undefined</div><div class="message-item  message-outgoing267b-2326e4521-4521f-267bc-2326e4521f"><div class="message-avatar"><figure class="avatar"><img src="https://steamcdn-a.akamaihd.net/steamcommunity/public/images/avatars/b5/b5ea76ada823f6110bd6b75fc8782a92874e6825_full.jpg" class="rounded-circle"></figure><div><h5>Libby Kathi</h5><div class="time" style="display:block" id="timeoutgoing267b-2326e4521-4521f-267bc-2326e4521f"> ' + formatAMPM(new Date) + ' </div></div></div><div class="message-content" style="display:block" id="outgoing267b-2326e4521-4521f-267bc-2326e4521f"><span class="text-typing">' + result + '</span></div></div></div>');
                        }
                        if (result == null) {
                            $("#" + divid + "").show();
                        }
                        scrollfunction();
                    }, 5000);
                }
            });
        }
        function formatAMPM(date) {
            var hours = date.getHours();
            var minutes = date.getMinutes();
            var ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12; // the hour '0' should be '12'
            minutes = minutes < 10 ? '0' + minutes : minutes;
            var strTime = hours + ':' + minutes + ' ' + ampm;
            return strTime;
        }
        function scrollfunction() {
            var objDiv = document.getElementById("chatbox");
            objDiv.scrollTop = objDiv.scrollHeight;
        }
        function formatJSONDate(jsonDate) {
            var date = new Date(jsonDate);
            var hours = date.getHours();
            var minutes = date.getMinutes();
            var ampm = hours >= 12 ? 'PM' : 'AM';
            hours = hours % 12;
            hours = hours ? hours : 12; // the hour '0' should be '12'
            minutes = minutes < 10 ? '0' + minutes : minutes;
            var strTime = hours + ':' + minutes + ' ' + ampm;
            return strTime;
        }
    </script>

    @*<div class="message-item  message-outgoingd365-263efc731-c7317-d365f-263efc7317"><div class="message-avatar"><figure class="avatar"><img src="https://steamcdn-a.akamaihd.net/steamcommunity/public/images/avatars/b5/b5ea76ada823f6110bd6b75fc8782a92874e6825_full.jpg" class="rounded-circle"></figure><div><h5>Libby Kathi</h5><div class="time" style="display:none" id="timeoutgoingd365-263efc731-c7317-d365f-263efc7317"> 9:21 AM </div></div></div><div class="message-content" style="display:block" id="outgoingd365-263efc731-c7317-d365f-263efc7317"><span class="text-typing">Typing...</span></div></div>*@
</body>
</html>
